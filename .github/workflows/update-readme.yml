# =============================================================================
# GitHub Action: Auto-Generate README from portfolio.json
# =============================================================================
#
# This workflow automatically updates your GitHub profile README whenever
# you modify portfolio.json. This ensures your GitHub profile always stays
# in sync with your portfolio website data.
#
# TRIGGERS:
# - When portfolio.json is modified (push to main/master)
# - Manual trigger via GitHub Actions UI (workflow_dispatch)
#
# HOW IT WORKS:
# 1. Reads portfolio.json from the repo
# 2. Generates a formatted README.md using the JSON data
# 3. Commits and pushes the updated README.md
#

name: Update README from Portfolio JSON

on:
  push:
    branches:
      - main
      - master
    paths:
      - 'portfolio.json'
  workflow_dispatch:  # Allow manual trigger

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Setup Node.js for running the generation script
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # Step 3: Generate README.md from portfolio.json
      - name: Generate README
        run: |
          node << 'EOF'
          const fs = require('fs');
          
          // Read portfolio.json
          const data = JSON.parse(fs.readFileSync('portfolio.json', 'utf-8'));
          
          // Extract GitHub username from socials URL
          const githubUsername = data.meta.socials.github.split('/').pop();
          
          // Generate README content
          const readme = `
# Hi, I'm ${data.meta.name} ğŸ‘‹

## ${data.meta.title}

${data.meta.tagline}

---

### ğŸš€ About Me

${data.aboutMe.description}

${data.aboutMe.highlights.map(h => `- âœ¨ ${h}`).join('\n')}

---

### ğŸ› ï¸ Tech Stack

**Frontend:**  
${data.skills.frontend.map(s => `\`${s}\``).join(' â€¢ ')}

**Backend:**  
${data.skills.backend.map(s => `\`${s}\``).join(' â€¢ ')}

**Tools:**  
${data.skills.tools.map(s => `\`${s}\``).join(' â€¢ ')}

---

### ğŸ’¼ Experience

${data.experience.map(exp => `
#### ${exp.title} @ ${exp.company}
ğŸ“ ${exp.location} | ğŸ“… ${exp.startDate} - ${exp.endDate}

${exp.description}

**Tech:** ${exp.technologies.map(t => \`\\\`\${t}\\\`\`).join(' â€¢ ')}
`).join('\n---\n')}

---

### ğŸ“ Education

${data.education.map(edu => `
**${edu.degree}**  
ğŸ›ï¸ ${edu.institution} | ğŸ“… ${edu.startYear} - ${edu.endYear}

${edu.details}
`).join('\n')}

---

### ğŸ“« Let's Connect!

- ğŸ“§ **Email:** [${data.contact.email}](mailto:${data.contact.email})
${data.meta.socials.linkedin ? \`- ğŸ’¼ **LinkedIn:** [\${data.meta.socials.linkedin.split('/').pop()}](\${data.meta.socials.linkedin})\` : ''}
${data.meta.socials.twitter ? \`- ğŸ¦ **Twitter:** [\${data.meta.socials.twitter.split('/').pop()}](\${data.meta.socials.twitter})\` : ''}
- ğŸŒ **Portfolio:** [View My Work](https://your-portfolio-url.vercel.app)

---

### ğŸ“Š GitHub Stats

<p align="center">
  <img src="https://github-readme-stats.vercel.app/api?username=${githubUsername}&show_icons=true&theme=tokyonight&hide_border=true" alt="GitHub Stats" />
</p>

<p align="center">
  <img src="https://github-readme-streak-stats.herokuapp.com/?user=${githubUsername}&theme=tokyonight&hide_border=true" alt="GitHub Streak" />
</p>

<p align="center">
  <img src="https://github-readme-stats.vercel.app/api/top-langs/?username=${githubUsername}&layout=compact&theme=tokyonight&hide_border=true" alt="Top Languages" />
</p>

---

### ğŸ·ï¸ Portfolio Projects

> Projects tagged with \`portfolio\` topic are automatically displayed on my portfolio website!

To see all my featured projects, visit my [Portfolio Website](https://your-portfolio-url.vercel.app).

---

<p align="center">
  <i>${data.contact.availability}</i><br/>
  <i>${data.contact.responseTime}</i>
</p>

---

<p align="center">
  <i>â­ This README is auto-generated from <a href="./portfolio.json">portfolio.json</a></i>
</p>
`;
          
          // Write README.md
          fs.writeFileSync('README.md', readme.trim());
          console.log('âœ… README.md generated successfully!');
          EOF

      # Step 4: Commit and push changes
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git diff --staged --quiet || git commit -m "ğŸ“ Auto-update README from portfolio.json"
          git push
