# =============================================================================
# GitHub Action: Auto-Generate README from portfolio.json
# =============================================================================
#
# This workflow automatically updates your GitHub profile README whenever
# you modify portfolio.json. This ensures your GitHub profile always stays
# in sync with your portfolio website data.
#
# TRIGGERS:
# - When portfolio.json is modified (push to main/master)
# - Manual trigger via GitHub Actions UI (workflow_dispatch)
#
# HOW IT WORKS:
# 1. Reads portfolio.json from the repo
# 2. Generates a formatted README.md using the JSON data
# 3. Commits and pushes the updated README.md
#

name: Update README from Portfolio JSON

on:
  push:
    branches:
      - main
      - master
    paths:
      - "portfolio.json"
  workflow_dispatch: # Allow manual trigger

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Setup Node.js for running the generation script
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # Step 3: Generate README.md from portfolio.json
      - name: Generate README
        run: node scripts/generate-readme.js

      # Step 4: Commit and push changes
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git diff --staged --quiet || git commit -m "üìù Auto-update README from portfolio.json"
          git push
